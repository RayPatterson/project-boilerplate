language: ruby
rvm:
- 2.0.0-p247
before_install:
- sudo apt-get update -qq
- sudo apt-get install -qq advancecomp gifsicle jhead jpegoptim libjpeg-progs optipng
  pngcrush
- wget http://static.jonof.id.au/dl/kenutils/pngout-20130221-linux.tar.gz
- tar -xzf pngout-*-linux.tar.gz
- mv pngout-*-linux pngout-linux
env:
  matrix:
  - PATH=pngout-linux/x86_64:$PATH
  global:
  - secure: jIEiBCkTZHkFvhhGOqin/G2TYOtvMCdkl6kGlBqWpWBVKjjYm6z7Ir+vroN6eRn9NKAhrL/eurZt++6dG3ZkgfS3Z/N8fxiQ9TjUL3CJ91CTBwqU0STS8PCe7VnFzN33XICUdFjqgf3dzqZajmougJT8X8zLOLRdxnDYC2eoEPg=
  - secure: l0fV7cXeBn9wjIjOW8C2pbA9Pm6hD0jInK3DE9gz25lY20B1R5H2Ao4KLS2Ju+GjW8+NXSLvR/FsVi1zMbVM8xePVOMv0ykiPOx2/wnmajq0RSbsnEAUiSUMRJpnO/rH7BzhJZC10A5qg3fRhTO5hbeeFCk2CRi8aOTnL3ZS3M8=
  - secure: X3p8XLrLahV0C5jqeab77Z4S/W7vC4SqkZncFWsNOXv8u74ONp6KBaoVRv9kDPf1mR7EhveDwc8dyrOk1TeWGabPjN6afP2Npoa3oqP1kcUuS7JA5uc1DDgvOvM0HR/U2ZKHiPsUIi5Q8XhiH4e7UWYyEbgN8RODZKmSW2vgg0I=
  - secure: k5PKRwXaFPaUzjdhZPcCzk4/ZX0a1x/wyHsRu/UghEd4GJ0uQ7svm0TOc/Q9iHH9s4mYmXDk+7OGqLGmnW6IEw0ayxkdNYeDieFaQQaH0N5kX76bI3H02c24Ze5a0TgsaszBLT0KsZe/oSMHdlPFaihXjMuSlGbKOZ/smkHOFj4=
install:
- npm install
- npm install -g grunt-cli
- npm install -g bower
- bower install
- bundle install
script: rake mm:build:$TRAVIS_BRANCH
after_success:
- git config --global user.email "$GH_EMAIL"
- git config --global user.name "$GH_NAME"
- git config credential.helper "store --file=.git/credentials"
- echo "https://${GH_TOKEN}:@github.com" > .git/credentials
- git config remote.origin.url https://$GH_NAME:$GH_TOKEN@github.com/$TRAVIS_REPO_SLUG.git
- export GIT_TAG=build-$TRAVIS_BRANCH-$(date -u "+%Y-%m-%d-%H-%M-%S")-$TRAVIS_BUILD_NUMBER
- git tag $GIT_TAG -a -m "Generated tag from TravisCI build $TRAVIS_BUILD_NUMBER"
- git push origin $GIT_TAG -q
- rake test:performance
branches:
  only:
  - production
  - staging
