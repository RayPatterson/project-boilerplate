language: ruby
rvm:
- 2.0.0-p247
before_install:
- sudo apt-get update -qq
- sudo apt-get install -qq advancecomp gifsicle jhead jpegoptim libjpeg-progs optipng
  pngcrush
- wget http://static.jonof.id.au/dl/kenutils/pngout-20130221-linux.tar.gz
- tar -xzf pngout-*-linux.tar.gz
- mv pngout-*-linux pngout-linux
env:
  matrix:
  - PATH=pngout-linux/x86_64:$PATH
  global:
  - secure: qMKpJC2UdN+aytIBmwpUY3Twii0A8/Wyo4UdNmA3IcBUCvo9ekUTphlh6BzFWE0FuJtldnatnzlaNcI2/aJ/SVrRszVNC9L4rj/HnH9yJl5DIuAPSfBcG0QxHyq7j3QV9c8N7TQg5PwI1eNj/D4TufpWPtcd2RyY2cxT8X0YWLE=
  - secure: CblK3xhza85DkMoZ60xAsZtPl8XV6rOqNfxHfTjugmkhDKZ1df5pmlxfwbFSBabjS5Ssd496D26iQcMVQckJHE7s5z2Cakeyyfavb6mvTzLXpMcB91dj1g97Kym62mE4CmBz3V3lDUzKd6HIXCZcpE5AwaGXxsUlVclnm8yd4Fg=
  - secure: RlbeeCDlbTmg+aF4n1D0EM8pcMWBLr6HD/quGyJMWYpH4BTxhZd+qH1TtnlZoFciTybPJAQmy7yR3rF3wNruW1SFTYqog9Z3+g8C/L0qYtrXlsLh0lqETHO4LeMTFx0zaU+DATaOiS3Cfm3PEobypTsyAWY2oWSnuwfpJihDzLU=
  - secure: fQXijx4JKx2dVz39voH+jRaP4eNetAWqcVzRENc1qIqdwYUyDK/dOR8owWC+9Lf+ZeU/bwhAq8Zq84kZyih/BY62E/3TyxjVqssvQmLobmXOmJ2/2rn22LVqOMBAp+klFymuzPbfhEGmBGLjdIq5OkLEA167j6duBJwu2y71lyA=
  - secure: OH5Qq9wwMKkYm6BWNqfJvGSDrtKX+ZmKBErCtXU/ik+X52h1GETpKFB8MRTHSxbBOf0EBcimWvh0ewnlyQBiZQcQOCdLErLJv4DXNbWuCePRakS9NvfOLYwy6zrjCLWYxVGRsRZ9el9YAGKF7VUliVSxyrZXBaohA2nWlbkWc2c=
install:
- npm i
- npm i -g bower grunt-cli
- bower i
- bundle install
script: rake mm:build:$TRAVIS_BRANCH
after_success:
- git config --global user.email "$GH_EMAIL"
- git config --global user.name "$GH_NAME"
- git config credential.helper "store --file=.git/credentials"
- echo "https://${GH_TOKEN}:@github.com" > .git/credentials
- git config remote.origin.url https://$GH_NAME:$GH_TOKEN@github.com/$TRAVIS_REPO_SLUG.git
- export GIT_TAG=build-$TRAVIS_BRANCH-$(date -u "+%Y-%m-%d-%H-%M-%S")-$TRAVIS_BUILD_NUMBER
- git tag $GIT_TAG -a -m "Generated tag from TravisCI build $TRAVIS_BUILD_NUMBER"
- git push origin $GIT_TAG -q
- rake test:performance
branches:
  only:
  - production
  - staging
